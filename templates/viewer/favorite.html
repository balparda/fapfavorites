<!DOCTYPE html>
<html lang='en-US'>
  <head>
    <meta charset='utf-8'/>
    <title>Imagefap-Favorites: Favorite {{ user_name|escape }}/{{ name|escape }}</title>
    <style>

      a.filter_show {color: green;}
      a.filter_show:visited {color: green;}
      a.filter_show:hover {color: green;}
      a.filter_show:active {color: green;}

      a.filter_hide {color: red;}
      a.filter_hide:visited {color: red;}
      a.filter_hide:hover {color: red;}
      a.filter_hide:active {color: red;}

      a.external {text-decoration: none;}

      th, td {padding: 5px;}

      td.album_duplicate {
        border-color: red;
        background-color: red;
      }
      td.has_duplicate {
        border-color: fuchsia;
        background-color: fuchsia;
      }
      td.has_perceptual {
        border-color: purple;
        background-color: purple;
      }

      td.selected {
        border-color: peru;
        background-color: peru;
        padding: 4px;
      }
      td.unselected {
        padding: 4px;
      }

    </style>
    <script type='text/javascript' language='javascript'>

      function switch_selection(sha) {
        if (document.getElementById(sha).className == 'selected') {
          document.getElementById(sha).className = 'unselected';
        } else {
          document.getElementById(sha).className = 'selected';
        }
      };

      function select_all() {
        for (i in ALL_SHA) {
          sha = ALL_SHA[i];
          document.getElementById(sha).className = 'selected';
        }
      };

      function select_none() {
        for (i in ALL_SHA) {
          sha = ALL_SHA[i];
          document.getElementById(sha).className = 'unselected';
        }
      };

      function get_selected() {
        sel = [];
        for (i in ALL_SHA) {
          sha = ALL_SHA[i];
          if (document.getElementById(sha).className == 'selected') {
            sel.push(sha);
          }
        }
        return sel;
      }

      function tag_form_submit() {
        sel = get_selected();
        if (parseInt(document.forms['selected_form']['tag_select'].value) > 0) {
          if (sel.length > 0) {
            document.forms['selected_form']['selected_blobs'].value = sel.join(',');
            return true;  // we can submit the form
          } else {
            alert('No images selected!');
          }
        } else {
          alert('No tag selected!');
        }
        return false;  // don't submit the form
      }

      var ALL_SHA = [
          {% for sha_group in stacked_blobs %}
            {% for _, sha in sha_group %}
              {% if sha %}
                "{{ sha }}",
              {% endif %}
            {% endfor %}
          {% endfor %}
      ];

    </script>
  </head>
  <body bgcolor='black' text='lightgray'>

    <h1>Favorite album <i>&quot;{{ name|escape }}&quot;</i> (User <i>&quot;{{ user_name|escape }}&quot;</i>)</h1>

    <p>Total {{ count }} images (in {{ pages }} pages). Last fetched on {{ date }}.</p>

    {% if error_message %}
      <p style='color: red;'><strong>{{ error_message }}</strong></p>
      <p>&nbsp;</p>
    {% endif %}
    {% if warning_message %}
      <p style='color: yellow;'><strong>{{ warning_message }}</strong></p>
      <p>&nbsp;</p>
    {% endif %}

    <table>
      <tr>
        <td>
          {% if show_duplicates %}
            <a href='{% url "favorite" user_id folder_id %}?dup=0&{{ portrait_url }}&{{ landscape_url }}&{{ tagging_url }}' class='filter_show'>
              Duplicates: <i><b>ON</i></b>
            </a><br/>
          {% else %}
            <a href='{% url "favorite" user_id folder_id %}?dup=1&{{ portrait_url }}&{{ landscape_url }}&{{ tagging_url }}' class='filter_hide'>
              Duplicates: <i><b>OFF</i></b>
            </a>
          {% endif %}
        </td>
        <td>
          {% if not locked_for_tagging %}
            images marked <span style='color: red;'>RED</span> have exact duplicates <i>in this album</i>;<br/>
            images marked <span style='color: fuchsia;'>FUCHSIA</span> have exact duplicates somewhere <i>not in the album</i>;<br/>
            images marked <span style='color: purple;'>PURPLE</span> have (non false-positive) perceptual duplicates <i>somewhere</i>
          {% endif %}
        </td>
      </tr>
      <tr>
        <td>
          {% if show_portraits %}
            <a href='{% url "favorite" user_id folder_id %}?{{ dup_url }}&portrait=0&{{ landscape_url }}&{{ tagging_url }}' class='filter_show'>
              Portrait-Aspect Images: <i><b>ON</i></b>
            </a>
          {% else %}
            <a href='{% url "favorite" user_id folder_id %}?{{ dup_url }}&portrait=1&{{ landscape_url }}&{{ tagging_url }}' class='filter_hide'>
              Portrait-Aspect Images: <i><b>OFF</i></b>
            </a>
          {% endif %}
        </td>
        <td>(images with <b>height</b> more than 10% larger than <b>width</b>)</td>
      </tr>
      <tr>
        <td>
          {% if show_landscapes %}
            <a href='{% url "favorite" user_id folder_id %}?{{ dup_url }}&{{ portrait_url }}&landscape=0&{{ tagging_url }}' class='filter_show'>
              Landscape-Aspect Images: <i><b>ON</i></b>
            </a>
          {% else %}
            <a href='{% url "favorite" user_id folder_id %}?{{ dup_url }}&{{ portrait_url }}&landscape=1&{{ tagging_url }}' class='filter_hide'>
              Landscape-Aspect Images: <i><b>OFF</i></b>
            </a>
          {% endif %}
        </td>
        <td>(images with <b>width</b> more than 10% larger than <b>height</b>)</td>
      </tr>
      <tr>
        {% if locked_for_tagging %}
          <td>
            <a href='{% url "favorite" user_id folder_id %}?{{ dup_url }}&{{ portrait_url }}&{{ landscape_url }}&lock=0' class='filter_show'>
              Locked for Tagging: <i><b>ON</i></b>
            </a>&nbsp;&nbsp;&#128274;
          </td>
          <td>(clicking on images will <i><b>select</i></b> them, tagging options available at bottom)</td>
        {% else %}
          <td>
            <a href='{% url "favorite" user_id folder_id %}?{{ dup_url }}&{{ portrait_url }}&{{ landscape_url }}&lock=1' class='filter_hide'>
              Locked for Tagging: <i><b>OFF</i></b>
            </a>&nbsp;&nbsp;&#128275;
          </td>
          <td>clicking on images will <i><b>open</i></b> them, no selection of images enabled</td>
        {% endif %}
      </tr>
      <tr>
        <td colspan='2'>
          {% if locked_for_tagging %}
            The image icon (<small><small>&#128444;</small></small>) will take you to the local image (blob) for inspection (this is always fine, only opens locally).<br/>
            Click on the images to select or deselect them. Selected images will show in <span style='color: peru;'>PERU</span> color.<br/>
            If you reload the page you will lose your selection! Go to the bottom of this page (<i>Ctrl+End</i>) to tag them.<br/>
            {% if not tags %}
              <b><i><span style='color: red;'>ATTENTION: You have NO tags, so selecting images will serve NO purpose!</span> <a href='{% url "tag" 0 %}'>Create tags first?</a></i></b><br/>
            {% endif %}
          {% endif %}
          The link icon (<small><small>&#128279;</small></small>) will take you to Imagefap original image: <b><i>beware</i></b>, as clicking will open Imagefap site!<br/>
          The <i>"gemini"</i> icon in duplicate images (<small>&#9802;</small>) will open the page showing the duplicates set for inspection and action.
        </td>
      </tr>
      {% if locked_for_tagging %}
        <tr>
          <td colspan='2' align='right'>
            <b><i>
              <a onclick='javascript:select_all();' class='filter_show'>Select ALL</a>&nbsp;&nbsp;&nbsp;&#10037;&nbsp;&nbsp;&nbsp;
              <a onclick='javascript:select_none();' class='filter_show'>Select NONE</a>
            </i></b>
          </td>
        </tr>
      {% endif %}
    </table>

    {% load static %}

    <p>&nbsp;</p>

    <table border='2'>
      {% for sha_group in stacked_blobs %}
        <tr>
          {% for img, sha in sha_group %}
            {% if sha %}
              {% with blob=blobs_data|lookup:sha %}
                {% if locked_for_tagging %}
                  <td align='center' valign='center' id='{{ sha }}' class='unselected'>
                    <img src='{% static blob.thumb %}'
                        onclick='javascript:switch_selection("{{ sha }}");'
                        title='{{ blob.name|escape }}&#10;{{ blob.sz }} - {{ blob.dimensions }}&#10;{{ blob.tags|escape }}{% if blob.is_duplicate %} - has exact duplicate{% endif %}{% if blob.is_percept %} - has perceptual duplicate{% endif %}'/><br/>
                    <small><small><small>
                      <a href='{% url "blob" sha %}' target='_blank' rel='noopener noreferrer'>&#128444;</a>
                      &nbsp;&nbsp;
                      <a href='{{ blob.imagefap }}' class='external' title='Image in Imagefap' target='_blank' rel='noopener noreferrer'>&#128279;</a>
                    </small></small></small>
                  </td>
                {% else %}
                  <td align='center' valign='center'
                      {% if blob.album_duplicate %}class='album_duplicate'{% else %}
                      {% if blob.has_duplicate %}class='has_duplicate'{% else %}
                      {% if blob.has_percept %}class='has_perceptual'{% endif %}{% endif %}{% endif %}>
                    <a href='{% url "blob" sha %}' target='_blank' rel='noopener noreferrer'>
                      <img src='{% static blob.thumb %}' title='{{ blob.name|escape }}&#10;{{ blob.sz }} - {{ blob.dimensions }}&#10;{{ blob.tags|escape }}'/></a>
                    &nbsp;<small><small><small>
                      <a href='{{ blob.imagefap }}' class='external' title='Image in Imagefap' target='_blank' rel='noopener noreferrer'>&#128279;</a>
                    </small></small>
                    {% if blob.album_duplicate or blob.has_duplicate or blob.has_percept %}
                      <a href='{% url "duplicate" sha %}' class='external' title='open duplicate info' target='_blank' rel='noopener noreferrer'>&#9802;</a>
                    {% endif %}
                    </small>
                  </td>
                {% endif %}
              {% endwith %}
            {% else %}
              <td></td>
            {% endif %}
          {% endfor %}
        </tr>
      {% empty %}
        <tr><td colspan='4'>No images in this favorite album</td></tr>
      {% endfor %}
    </table>

    <p>&nbsp;</p>

    <form id='selected_form' name='selected_form'
        action='{% url "favorite" user_id folder_id %}?{{ dup_url }}&{{ portrait_url }}&{{ landscape_url }}&{{ tagging_url }}'
        method='post'>
      {% csrf_token %}

      <input id='selected_blobs' name='selected_blobs' type='hidden' value=''/>

      {% if locked_for_tagging and tags %}

        <p>
          <label for='tag_select'>Tag selected images with:</label>
          <select name='tag_select' id='tag_select'>
            <option value=''>-- Please choose a tag --</option>
            {% for id, _, parents in tags %}
              <option value='{{ id }}'>{{ parents|escape }}</option>
            {% endfor %}
          </select>&nbsp;&nbsp;&nbsp;
          <input type='submit' value='Save Tag' onClick="return tag_form_submit();">
        </p>
        <p>&nbsp;</p>

      {% endif %}

    </form>

    <p><a href='{% url "favorites" user_id %}'>(Go To: User <i>&quot;{{ user_name|escape }}&quot;</i> Page)</a></p>

    <p><a href='{% url "users" %}'>(Go To: Users Page)</a></p>

    <p><a href='{% url "index" %}'>(Go To: Home Page)</a></p>

  </body>
</html>
